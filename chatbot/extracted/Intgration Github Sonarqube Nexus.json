{
  "filename": "Intgration Github Sonarqube Nexus.pdf",
  "content": "Int√©gration de GitHub avec \nJoget, SonarQube, Nexus et \nAutomatisation via Docker\n√âtape 1 : Installation d‚ÄôOpenSSH Server pour \nl‚Äôutilisation de Terminus\n1. Ouvrir un terminal sur votre machine virtuelle Ubuntu.\n2. Mettre √† jour la liste des paquets :\n```bash\nsudo apt update\n```\n3. Installer OpenSSH Server :\n```bash\nsudo apt install openssh-server -y\n```\n4. V√©rifier l‚Äô√©tat du service SSH :\n```bash\nsudo systemctl status ssh\n```\nSi le service est actif (running), l‚Äôinstallation est r√©ussie.\nSi SSH n‚Äôest pas en cours d‚Äôex√©cution, le d√©marrer :\n```bash\nsudo systemctl start ssh\n```\nActiver le d√©marrage automatique de SSH au boot :\n```bash\nsudo systemctl enable ssh\n```\n√â\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n1\n\n√âtape 2 : Pr√©requis - Installation de Docker et Docker \nCompose\nAjout du d√©p√¥t Docker\n1. Ajouter la cl√© GPG officielle de Docker et configurer le d√©p√¥t :\n```bash\nsudo apt-get update\n```\n```bash\nsudo apt-get install ca-certificates curl\n```\n```bash\nsudo install -m 0755 -d /etc/apt/keyrings\n```\n```bash\nsudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/ap\n```\nt/keyrings/docker.asc\n```bash\nsudo chmod a+r /etc/apt/keyrings/docker.asc\n```\n2. Ajouter le d√©p√¥t Docker aux sources APT :\necho \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/do\ncker.asc] https://download.docker.com/linux/ubuntu \\\n  $(. /etc/os-release && echo \"${UBUNTU_CODENAME:-$VERSION_CODE\nNAME}\") stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```bash\nsudo apt-get update\n```\nInstallation des paquets Docker\nPour installer la derni√®re version de Docker, ex√©cutez :\n```bash\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugi\n```\nn docker-compose-plugin -y\nV√©rification des versions install√©es\n```bash\ndocker --version\n```\n```bash\ndocker compose version\n```\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n2\n\n√âtape 3 : D√©ploiement des Conteneurs Jenkins, \nSonarQube et Nexus avec Docker Compose\n1. Cr√©er un fichier docker-compose.yml  et y ajouter la configuration suivante :\nversion: '3'\nservices:\n  jenkins:\n    image: jenkins/jenkins:lts\n    container_name: jenkins\n    ports:\n      - \"8081:8080\"\n      - \"50000:50000\"\n    volumes:\n      - jenkins_home:/var/jenkins_home\n  sonarqube:\n    image: sonarqube:latest\n    container_name: sonarqube\n    ports:\n      - \"9000:9000\"\n    environment:\n      - SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true\n  nexus:\n    image: sonatype/nexus3\n    container_name: nexus\n    ports:\n      - \"8082:8081\"\n      - \"8085:8085\"\nvolumes:\n  jenkins_home:\n2. Lancer les conteneurs en arri√®re-plan :\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n3\n\n```bash\ndocker compose up -d\n```\nR√©cup√©ration des mots de passe par d√©faut\nJenkins :(Chercher la ligne indiquant le mot de passe initial)\n```bash\ndocker logs jenkins\n```\nSonarQube :Utilisateur par d√©faut : admin , Mot de passe par d√©faut : admin\nNexus :\n```bash\ndocker exec -it nexus cat /nexus-data/admin.password\n```\n√âtape 4 : Gestion des Branches GitHub dans un Projet \nJoget\n1. Initialisation du Projet et Configuration GitHub\n1.1 Cr√©ation du projet et du r√©f√©rentiel\n1. Cr√©er un projet Joget nomm√© my_app .\n2. Cr√©er un d√©p√¥t GitHub du m√™me nom ( my_app ).\n3. Partager un Token d‚ÄôAuthentification avec l‚Äô√©quipe via un canal priv√© (ex: \nSlack, Teams).\n1.2 Configuration de Git dans Joget\nDans Joget, aller dans :\nSettings ‚Üí Git Config\nRemplir les champs suivants :\nURL du d√©p√¥t GitHub : https://github.com/mon-org/my_app.git\nNom d‚Äôutilisateur GitHub\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n4\n\nToken d‚Äôacc√®s personnel (dans le champ mot de passe)\n2. Mise en place des branches Git\n2.1 Cr√©ation de la branche principale ( main )\nV√©rifier que la branche main  existe bien :\ngit checkout -b main\ngit push origin main\nSi elle n‚Äôexiste pas encore, la renommer :\ngit branch -M main\ngit push -u origin main\n2.2 Structuration des branches\nChaque d√©veloppeur doit travailler sur une branche sp√©cifique issue de main  :\ngit checkout -b my_app_2 main\ngit push origin my_app_2\ngit checkout -b my_app_3 main\ngit push origin my_app_3\n√âtape 5 : Extraction des Codes\nScript 1 : Extraction des Codes Java et SQL\nObjectif\nCe script est con√ßu pour extraire les morceaux de code Java et SQL des fichiers \nJSON et XML d'une application Joget.\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n5\n\nIl analyse les fichiers de formulaires JSON ainsi que le fichier appDefinition.xml  pour \nd√©tecter et extraire tout code pertinent, puis les enregistre dans des fichiers \ndistincts.\nExplication du Code\n1Ô∏è‚É£ D√©finition des R√©pertoires et Chemins\nBASE_DIR = \"/opt/joget/wflow/scripts/output\"\nFORMS_DIR = \"/opt/joget/wflow/app_src/vente_voitures/vente_voitures_1/form\ns\"\nAPPDEF_FILE = \"/opt/joget/wflow/app_src/vente_voitures/vente_voitures_1/ap\npDefinition.xml\"\nJAVA_DIR = os.path.join(BASE_DIR, \"java\")\nSQL_DIR = os.path.join(BASE_DIR, \"sql\")\nBASE_DIR : Dossier o√π les fichiers extraits seront stock√©s.\nFORMS_DIR : Contient les formulaires de l'application au format JSON.\nAPPDEF_FILE : Contient la d√©finition de l'application avec du code Java et \nSQL.\nJAVA_DIR et SQL_DIR : Sous-dossiers o√π seront stock√©s respectivement les \ncodes Java et SQL.\n2Ô∏è‚É£ Cr√©ation des Dossiers de Sortie\nos.makedirs(JAVA_DIR, exist_ok=True)\nos.makedirs(SQL_DIR, exist_ok=True)\nV√©rifie si les dossiers existent, sinon les cr√©e pour stocker les fichiers extraits.\n3Ô∏è‚É£ D√©finition des Expressions R√©guli√®res\nJAVA_PATTERN = re.compile(r\"\\b(import java|public class|void main|System\\.\nout\\.println|PreparedStatement|Connection)\\b\")\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n6\n\nSQL_PATTERN = re.compile(r\"\\b(SELECT|INSERT|UPDATE|DELETE|CREATE|A\nLTER|DROP|TRUNCATE|FROM|WHERE)\\b\", re.IGNORECASE)\nJAVA_PATTERN : Identifie les scripts Java en recherchant des mots-cl√©s \nJava.\nSQL_PATTERN : Identifie les requ√™tes SQL en d√©tectant des mots-cl√©s SQL \ncomme SELECT , INSERT , etc.\n4Ô∏è‚É£ Suppression des Fichiers Anciens\ndef clear_output_directory():\n    for directory in [JAVA_DIR, SQL_DIR]:\n        if os.path.exists(directory):\n            for file in os.listdir(directory):\n                file_path = os.path.join(directory, file)\n                try:\n                    os.remove(file_path)\n                except Exception as e:\n                    print(f\"‚ö†Ô∏è Impossible de supprimer {file_path}: {e}\")\nSupprime les fichiers pr√©c√©demment g√©n√©r√©s pour √©viter les doublons.\n5Ô∏è‚É£ Extraction et Enregistrement des Codes\ndef save_code(directory, base_name, extension, content, index):\n    file_name = f\"{base_name}_{index}.{extension}\"\n    file_path = os.path.join(directory, file_name)\n    with open(file_path, \"w\", encoding=\"utf-8\") as f:\n        f.write(content)\n    print(f\"‚úÖ Fichier g√©n√©r√© : {file_path}\")\nCr√©e un fichier pour chaque extrait de code trouv√© et l‚Äôenregistre sous un nom \nunique.\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n7\n\n6Ô∏è‚É£ Extraction des Codes des Fichiers JSON\ndef extract_code_from_json(file_path):\n    with open(file_path, \"r\", encoding=\"utf-8\") as f:\n        try:\n            data = json.load(f)\n        except json.JSONDecodeError:\n            print(f\"‚ùå ERREUR: Impossible de lire {file_path}\")\n            return\nOuvre et charge le fichier JSON.\nG√®re les erreurs en cas de JSON mal form√©.\n  extracted_java = []\n    extracted_sql = []\n    def search_code(element):\n        if isinstance(element, dict):\n            for key, value in element.items():\n                if key == \"script\" and isinstance(value, str):\n                    if JAVA_PATTERN.search(value):\n                        extracted_java.append(value.strip())\n                    elif SQL_PATTERN.search(value):\n                        extracted_sql.append(value.strip())\n                elif isinstance(value, (dict, list)):\n                    search_code(value)\nRecherche r√©cursive dans le JSON pour extraire les scripts Java et SQL.\n7Ô∏è‚É£ Extraction des Codes de appDefinition.xml\ndef extract_code_from_appdefinition():\n    if not os.path.exists(APPDEF_FILE):\n        print(f\"‚ùå ERREUR : Fichier {APPDEF_FILE} introuvable\")\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n8\n\n        return\n    tree = ET.parse(APPDEF_FILE)\n    root = tree.getroot()\n    extracted_java = []\n    extracted_sql = []\n    for elem in root.iter(\"pluginProperties\"):\n        raw_code = elem.text\n        if raw_code:\n            if JAVA_PATTERN.search(raw_code):\n                extracted_java.append(raw_code.strip())\n            elif SQL_PATTERN.search(raw_code):\n                extracted_sql.append(raw_code.strip())\nParcourt appDefinition.xml pour trouver les propri√©t√©s contenant du code \nJava ou SQL.\n8Ô∏è‚É£ Ex√©cution du Script\nclear_output_directory()\nfor filename in os.listdir(FORMS_DIR):\n    if filename.endswith(\".json\"):\n        extract_code_from_json(os.path.join(FORMS_DIR, filename))\nextract_code_from_appdefinition()\nNettoie les anciens fichiers, puis ex√©cute l'extraction sur tous les fichiers.\nScript 2 : Extraction des Scripts JavaScript\nObjectif\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n9\n\nCe script analyse les fichiers JSON des formulaires Joget pour extraire les scripts \nJavaScript int√©gr√©s.\nExplication du Code\n1Ô∏è‚É£ D√©finition des Chemins\nFORMS_DIR = \"/opt/joget/wflow/app_src/vente_voitures/vente_voitures_1/form\ns\"\nOUTPUT_JS_DIR = \"/opt/joget/wflow/scripts/output/js\"\nFORMS_DIR : Dossier contenant les fichiers JSON des formulaires.\nOUTPUT_JS_DIR : Dossier o√π seront stock√©s les fichiers JS extraits.\n2Ô∏è‚É£ Cr√©ation du Dossier de Sortie\nos.makedirs(OUTPUT_JS_DIR, exist_ok=True)\nCr√©e le dossier js  si inexistant.\n3Ô∏è‚É£ Suppression des Anciens Scripts\nfor file in os.listdir(OUTPUT_JS_DIR):\n    file_path = os.path.join(OUTPUT_JS_DIR, file)\n    try:\n        os.remove(file_path)\n        print(f\"üóëÔ∏è Supprim√© : {file_path}\")\n    except Exception as e:\n        print(f\"‚ö†Ô∏è Impossible de supprimer {file_path}: {e}\")\nSupprime tous les anciens fichiers JS.\n4Ô∏è‚É£ Extraction des Scripts JavaScript\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n10\n\ndef extract_js_from_json(file_path):\n    try:\n        with open(file_path, \"r\", encoding=\"utf-8\") as f:\n            data = json.load(f)\n        scripts = []\n        def search_elements(elements):\n            if isinstance(elements, list):\n                for element in elements:\n                    search_elements(element)\n            elif isinstance(elements, dict):\n                if elements.get(\"className\") == \"org.joget.apps.form.lib.CustomHT\nML\":\n                    js_code = elements.get(\"properties\", {}).get(\"value\", \"\")\n                    if \"<script>\" in js_code:\n                        clean_js = re.sub(r\"<\\/?script.*?>\", \"\", js_code, flags=re.DOTAL\nL).strip()\n                        scripts.append(clean_js)\n                for key, value in elements.items():\n                    if isinstance(value, (dict, list)):\n                        search_elements(value)\n        search_elements(data.get(\"elements\", []))\n        return scripts\n    except json.JSONDecodeError as e:\n        print(f\"‚ùå Erreur JSON dans {file_path}: {e}\")\n        return []\nRecherche r√©cursivement dans le JSON des scripts JavaScript, en les \nnettoyant des balises <script> .\n5Ô∏è‚É£ Sauvegarde des Scripts JS\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n11\n\nfor form_file in os.listdir(FORMS_DIR):\n    if form_file.endswith(\".json\"):\n        form_path = os.path.join(FORMS_DIR, form_file)\n        extracted_scripts = extract_js_from_json(form_path)\n        if extracted_scripts:\n            for index, script_content in enumerate(extracted_scripts, start=1):\n                script_filename = f\"{form_file.replace('.json', '')}_script_{index}.js\"\n                script_path = os.path.join(OUTPUT_JS_DIR, script_filename)\n                with open(script_path, \"w\", encoding=\"utf-8\") as script_file:\n                    script_file.write(script_content)\n                print(f\"‚úÖ Fichier JS extrait : {script_path}\")\nStocke chaque script extrait sous forme de fichier .js .\nStructure des R√©pertoires\nAvant d'ex√©cuter les scripts, assurez-vous que l'arborescence suivante est \nrespect√©e dans votre conteneur Joget.\n/opt/joget/wflow/\n‚îÇ‚îÄ‚îÄ app_src/\n‚îÇ   ‚îî‚îÄ‚îÄ vente_voitures/\n‚îÇ       ‚îî‚îÄ‚îÄ vente_voitures_1/\n‚îÇ           ‚îú‚îÄ‚îÄ forms/                # Contient les fichiers JSON des formulaires\n‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ form1.json\n‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ form2.json\n‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ ...\n‚îÇ           ‚îú‚îÄ‚îÄ appDefinition.xml      # Fichier contenant la d√©finition de l'applica\ntion\n‚îÇ\n‚îî‚îÄ‚îÄ scripts/\n    ‚îú‚îÄ‚îÄ extract_code.py                # Script pour extraire Java et SQL\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n12\n\n    ‚îú‚îÄ‚îÄ extract_js.py                   # Script pour extraire JavaScript\n    ‚îú‚îÄ‚îÄ output/                         # Dossier contenant les fichiers g√©n√©r√©s\n    ‚îÇ   ‚îú‚îÄ‚îÄ java/\n    ‚îÇ   ‚îú‚îÄ‚îÄ sql/\n    ‚îÇ   ‚îú‚îÄ‚îÄ js/\n    ‚îÇ   ‚îî‚îÄ‚îÄ ...\nD√©ploiement des Scripts\n1. Copiez les fichiers extract_code.py  et extract_js.py  dans le r√©pertoire \n/opt/joget/wflow/scripts/ .\n```bash\ndocker exec -it jogetapp \n```\ncd /opt/joget/wflow/scripts\nextract_code.py\nextract_js.py\n√âtape 6 : Configuration du Conteneur Joget ( jogetapp )\nAvant d'ex√©cuter les scripts et d'automatiser l'extraction des codes, il est essentiel \nd'installer certains outils et de configurer l'environnement dans le conteneur \nJoget ( jogetapp ).\n1Ô∏è‚É£ Acc√©der au Conteneur Joget\nTout d'abord, ouvrez un terminal et entrez dans le conteneur Joget en ex√©cutant :\n```bash\ndocker exec -it jogetapp \n```\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n13\n\nVous serez maintenant dans l‚Äôenvironnement du conteneur.\n2Ô∏è‚É£ Mise √† Jour et Installation des Outils N√©cessaires\nDans le conteneur, ex√©cutez les commandes suivantes :\nMettre √† jour les paquets existants\napt update && apt upgrade -y\nInstaller les outils de base\napt install -y wget unzip 3 3-pip nano vim\nwget  : Permet de t√©l√©charger des fichiers √† partir d‚ÄôInternet.\nunzip  : Utilis√© pour extraire des fichiers compress√©s.\n3  : Langage requis pour ex√©cuter les scripts d'extraction.\n3-pip  : Gestionnaire de paquets  (utile si des d√©pendances doivent √™tre \ninstall√©es).\nnano  et vim  : √âditeurs de texte pour modifier des fichiers si n√©cessaire.\n√âtape 7 : Analyse de Code avec SonarQube\nL‚Äôobjectif de cette √©tape est d‚Äôinstaller et configurer SonarQube Scanner, d‚Äôactiver \nl‚Äôanalyse de code pour Java, SQL et JavaScript, et d‚Äôint√©grer le plugin SQL pour \nSonarQube.\n1Ô∏è‚É£ G√©n√©rer un Token d'Authentification dans \nSonarQube\nAvant de lancer l‚Äôanalyse, SonarQube n√©cessite un token d‚Äôauthentification. \nSuivez ces √©tapes pour g√©n√©rer un token personnel :\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n14\n\n1. Se connecter √† SonarQube\nAcc√©dez √† votre instance SonarQube (exemple : http://localhost:9000 ).\nConnectez-vous avec un compte administrateur ( admin  / admin  par d√©faut).\n2. Cr√©er un token\nDans le menu en haut √† droite, cliquez sur \"Mon compte\".\nAllez dans l‚Äôonglet \"S√©curit√©\".\nEntrez un nom pour le token (ex: jenkins-sonar-token ).\nCliquez sur \"G√©n√©rer\".\nCopiez et enregistrez le token affich√© (‚ö†Ô∏è Vous ne pourrez plus le voir \napr√®s).\n3. Utilisation dans Jenkins\nDans Jenkins ‚Üí Gestion des Credentials, ajoutez une nouvelle Credential \n:\nType : Secret Text\nID : SONAR_TOKEN\nValeur : (collez le token g√©n√©r√©).\n2Ô∏è‚É£ Installation de SonarQube Scanner\nExplication du Stage : Prepare SonarQube Scanner\nCe stage v√©rifie si SonarQube Scanner est install√© sur la machine Jenkins et \nl‚Äôinstalle si n√©cessaire.\nstage('Prepare SonarQube Scanner') {\n    steps {\n        script {\n            echo \"üîç Checking if SonarQube Scanner is installed...\"\n        }\n        sh '''\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n15\n\n            if [ ! -d \"sonar-scanner\" ]; then\n                echo \"üöÄ Installing SonarQube Scanner...\"\n                apt-get update && apt-get install -y wget unzip\n                wget -q https://binaries.sonarsource.com/Distribution/sonar-scanne\nr-cli/sonar-scanner-cli-5.0.1.3006-linux.zip -O sonar-scanner.zip\n                unzip -q sonar-scanner.zip\n                mv sonar-scanner-5.0.1.3006-linux sonar-scanner\n                chmod +x sonar-scanner/bin/sonar-scanner\n            else\n                echo \"‚úÖ SonarQube Scanner is already installed.\"\n            fi\n        '''\n    }\n}\nExplication des commandes\nV√©rifie si le r√©pertoire sonar-scanner  existe.\nSi non, il :\nMet √† jour les paquets.\nInstalle wget  et unzip  (au cas o√π ils ne sont pas install√©s).\nT√©l√©charge SonarQube Scanner CLI v5.0.1.3006.\nD√©compresse et renomme le dossier en sonar-scanner .\nRend l‚Äôex√©cutable sonar-scanner/bin/sonar-scanner  utilisable.\n3Ô∏è‚É£ Installation du Plugin SQL pour SonarQube\nPar d√©faut, SonarQube ne supporte pas l'analyse des fichiers SQL. Il faut donc \najouter un plugin tiers qui permet de scanner les fichiers SQL.\nInstallation du Plugin SQL\n1. V√©rifier et mettre √† jour Java\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n16\n\njava -version\nSonarQube requiert Java 17+.\nSi vous avez une version inf√©rieure, mettez √† jour Java :\n```bash\nsudo apt update\n```\n```bash\nsudo apt install openjdk-17-jdk\n```\njava -version\nD√©finir Java 17 comme version par d√©faut :\n```bash\nsudo update-alternatives --config java\n```\n2. Cloner le plugin SQL SonarQube\ngit clone https://github.com/gretard/sonar-sql-plugin.git\ncd sonar-sql-plugin\n3. Compiler et installer le plugin\nmvn versions:display-dependency-updates spotless:check spotless:apply \ninstall\n4. D√©ployer le plugin dans SonarQube\nCopier le fichier .jar  g√©n√©r√© vers le dossier des plugins SonarQube :\n```bash\ndocker cp sonar-sql-plugin/src/sonar-sql-plugin/target/sonar-sql-plug\n```\nin-1.1.0.jar sonarqube:/opt/sonarqube/extensions/plugins/\nRed√©marrer SonarQube :\n```bash\ndocker restart sonarqube\n```\n4Ô∏è‚É£‚Äô\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n17\n\n4Ô∏è‚É£ Ex√©cution de l‚ÄôAnalyse avec SonarQube\nUne fois SonarQube Scanner install√© et le plugin SQL ajout√©, nous pouvons \nanalyser notre code.\nExplication du Stage : SonarQube Analysis\nstage('SonarQube Analysis') {\n    steps {\n        sh '''\n            if [ -d \"./output/java\" ] || [ -d \"./output/sql\" ] || [ -d \"./output/js\" ]; then\n                echo \"‚úÖ Files found, proceeding with SonarQube analysis...\"\n                sonar-scanner/bin/sonar-scanner \\\n                  -Dsonar.projectKey=voitures \\\n                  -Dsonar.projectName=voitures \\\n                  -Dsonar.host.url=\"${SONAR_HOST_URL}\" \\\n                  -Dsonar.login=\"${SONAR_TOKEN}\" \\\n                  -Dsonar.sources=./output \\\n                  -Dsonar.inclusions=\"**/*.java,**/*.sql,**/*.js\" \\\n                  -Dsonar.java.binaries=. \\\n                  -Dsonar.scm.disabled=true \\\n                  -Dsonar.sourceEncoding=UTF-8 \\\n                  -Dsonar.verbose=true\n            else\n                echo \"üö® ERROR: No Java, SQL, or JS files found in ./output!\"\n                exit 1\n            fi\n        '''\n    }\n}\nExplication des param√®tres\nV√©rifie la pr√©sence des fichiers √† analyser ( Java, SQL, JS ).\nLance SonarQube Scanner en d√©finissant les options :\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n18\n\nDsonar.projectKey=voitures  : Nom du projet dans SonarQube.\nDsonar.projectName=voitures  : Nom affich√© dans SonarQube.\nDsonar.host.url=\"${SONAR_HOST_URL}\"  : URL du serveur SonarQube.\nDsonar.login=\"${SONAR_TOKEN}\"  : Utilise le token d‚Äôauthentification.\nDsonar.sources=./output  : Sp√©cifie le r√©pertoire contenant les fichiers extraits.\nDsonar.inclusions=\"**/*.java,**/*.sql,**/*.js\"  : Sp√©cifie les fichiers √† analyser.\nDsonar.java.binaries=.  : Indique o√π trouver les fichiers binaires Java.\nDsonar.scm.disabled=true  : D√©sactive l‚Äôanalyse du gestionnaire de versions (Git).\nDsonar.sourceEncoding=UTF-8  : D√©finit l‚Äôencodage des fichiers source.\nDsonar.verbose=true  : Active le mode verbeux pour plus de logs.\n√âtape 8 : Exportation et Upload du fichier JWA vers \nNexus\nL'objectif de cette √©tape est d'exporter l'application Joget sous forme de fichier \nJWA et de l'envoyer dans un repository Nexus pour stockage et gestion.\n1Ô∏è‚É£ Cr√©ation d‚Äôun Repository Nexus\nAvant de pouvoir uploader le fichier JWA, il est n√©cessaire de configurer un \nrepository Nexus.\nAcc√©der √† Nexus\n1. Ouvrir Nexus Repository Manager via l'URL :\nhttp://192.168.193.128:8082\n2. Se connecter avec :\nUtilisateur : admin\nMot de passe : (retrouv√© via docker exec -it nexus cat /nexus-data/admin.password )\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n19\n\nCr√©er un Repository RAW Hosted\nNous allons cr√©er un repository Raw Hosted, car nous voulons stocker un fichier \nJWA qui ne correspond pas aux formats standard comme Maven ou npm.\n1. Aller dans l'interface Nexus\nSe connecter √† Nexus Repository Manager.\nAller dans \"Repositories\".\nCliquer sur \"Create repository\".\n2. Choisir le type de repository\nS√©lectionner \"raw (hosted)\".\n3. Configurer le repository\nName : vente_voitures-repo\nVersion policy : Release\nDeployment policy : Allow redeploy\n4. Enregistrer la configuration.\n2Ô∏è‚É£ Explication du Stage Export & Upload JWA to Nexus\nCe stage effectue trois actions principales :\n1. Exporter l'application Joget sous forme de fichier .jwa .\n2. V√©rifier la validit√© du fichier export√©.\n3. Uploader le fichier sur Nexus.\nstage('Export & Upload JWA to Nexus (joget-repo)') {\n    steps {\n        script {\n            echo \"üì¶ Exporting application RSU from Joget...\"\n        }\n        sh '''\n        # D√©finition des variables\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n20\n\n        APP_NAME=\"vente_voitures\"\n        APP_ID=\"1\"\n        TIMESTAMP=$(date +\"%Y%m%d%H%M%S\")\n        JWA_FILE=\"APP_${APP_NAME}-${APP_ID}-${TIMESTAMP}.jwa\"\n        EXPORT_PATH=\"/opt/joget/wflow/export\"\n        echo \"üì¶ Exporting: Name=$APP_NAME, ID=$APP_ID, File=$JWA_FILE\"\n        # Installation de zip dans le conteneur Joget si n√©cessaire\n        docker exec -u root jogetapp  -c \"apt-get update && apt-get install -y zi\np\"\n        # Cr√©ation du dossier d'exportation et modification des permissions\n        docker exec -u root jogetapp  -c \"mkdir -p ${EXPORT_PATH} && chmod -\nR 777 ${EXPORT_PATH}\"\n        # Exporter l'application en tant que fichier JWA\n        docker exec jogetapp  -c \"cd /opt/joget/wflow/app_src && zip -r ${EXPO\nRT_PATH}/${JWA_FILE} ${APP_NAME} -x \\\"${APP_NAME}/.git/*\\\"\"\n        # V√©rifier la taille du fichier export√©\n        FILE_SIZE=$(docker exec jogetapp  -c \"stat -c %s ${EXPORT_PATH}/${J\nWA_FILE}\")\n        if [ \"$FILE_SIZE\" -lt 1024 ]; then\n            echo \"‚ùå ERROR: Exported JWA file seems empty (size: ${FILE_SIZE} \nbytes).\"\n            exit 1\n        fi\n        echo \"‚úÖ Export successful! File: ${JWA_FILE} (Size: ${FILE_SIZE} byte\ns)\"\n        # Copier le fichier JWA export√© de Joget vers Jenkins\n        docker cp jogetapp:${EXPORT_PATH}/${JWA_FILE} .\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n21\n\n        if [ ! -f \"${JWA_FILE}\" ]; then\n            echo \"‚ùå ERROR: JWA file was not copied correctly to Jenkins.\"\n            exit 1\n        fi\n        echo \"üì§ Uploading ${JWA_FILE} to Nexus...\"\n        # Upload du fichier vers Nexus\n        curl -u admin:Mouhamed2000** --upload-file ${JWA_FILE} \\\n        \"http://192.168.193.128:8082/repository/vente_voitures-repo/com/voiture\ns/jwa/${APP_ID}/${JWA_FILE}\"\n        echo \"‚úÖ Upload completed successfully to joget-repo!\"\n        '''\n    }\n}\n3Ô∏è‚É£ Explication du Code\n1. D√©finition des Variables\nAPP_NAME=\"vente_voitures\"\nAPP_ID=\"1\"\nTIMESTAMP=$(date +\"%Y%m%d%H%M%S\")\nJWA_FILE=\"APP_${APP_NAME}-${APP_ID}-${TIMESTAMP}.jwa\"\nEXPORT_PATH=\"/opt/joget/wflow/export\"\nAPP_NAME  : Nom de l'application.\nAPP_ID  : Identifiant de l'application.\nTIMESTAMP  : G√©n√®re un timestamp pour avoir un fichier unique \n( YYYYMMDDHHMMSS ).\nJWA_FILE  : Nom du fichier .jwa  qui sera export√©.\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n22\n\nEXPORT_PATH  : Chemin o√π le fichier sera stock√© dans le conteneur Joget.\n2. Installation et Pr√©paration du Conteneur Joget\n```bash\ndocker exec -u root jogetapp  -c \"apt-get update && apt-get install -y zip\"\n```\n```bash\ndocker exec -u root jogetapp  -c \"mkdir -p ${EXPORT_PATH} && chmod -R 77\n```\n7 ${EXPORT_PATH}\"\nInstalle zip  si ce n‚Äôest pas d√©j√† install√©.\nCr√©e le dossier d‚Äôexportation et donne les permissions n√©cessaires.\n3. Export de l'Application en .jwa\n```bash\ndocker exec jogetapp  -c \"cd /opt/joget/wflow/app_src && zip -r ${EXPORT_P\n```\nATH}/${JWA_FILE} ${APP_NAME} -x \\\"${APP_NAME}/.git/*\\\"\"\nCompresse l‚Äôapplication Joget situ√©e dans /opt/joget/wflow/app_src  en excluant le \ndossier .git .\nStocke le fichier compress√© dans ${EXPORT_PATH} .\n4. V√©rification de l'Exportation\nFILE_SIZE=$(docker exec jogetapp  -c \"stat -c %s ${EXPORT_PATH}/${JWA_\nFILE}\")\nif [ \"$FILE_SIZE\" -lt 1024 ]; then\n    echo \"‚ùå ERROR: Exported JWA file seems empty (size: ${FILE_SIZE} byte\ns).\"\n    exit 1\nfi\nV√©rifie la taille du fichier export√©.\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n23\n\nSi la taille est inf√©rieure √† 1 Ko, on consid√®re que le fichier est vide et on \narr√™te le processus.\n5. Copie du Fichier JWA vers Jenkins\n```bash\ndocker cp jogetapp:${EXPORT_PATH}/${JWA_FILE} .\n```\nCopie le fichier depuis le conteneur vers Jenkins pour l'envoyer √† Nexus.\nif [ ! -f \"${JWA_FILE}\" ]; then\n    echo \"‚ùå ERROR: JWA file was not copied correctly to Jenkins.\"\n    exit 1\nfi\nV√©rifie si le fichier a bien √©t√© copi√©.\n6. Upload du Fichier JWA vers Nexus\n```bash\ncurl -u admin:Mouhamed2000** --upload-file ${JWA_FILE} \\\n```\n\"http://192.168.193.128:8082/repository/vente_voitures-repo/com/voitures/jwa/\n${APP_ID}/${JWA_FILE}\"\nUtilise curl  pour envoyer le fichier vers Nexus.\nAuthentification avec l‚Äôutilisateur admin  et mot de passe.\nChemin Nexus :\nhttp://192.168.193.128:8082/repository/vente_voitures-repo/com/voitures/j\nwa/1/APP_vente_voitures-1-<timestamp>.jwa\nUne fois le fichier upload√©, un message ‚úÖ Upload completed successfully to joget-repo!  est \naffich√©.\n√âtape 9 : Explication Compl√®te du Pipeline Jenkins\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n24\n\npipeline.sh\nCe pipeline Jenkins est con√ßu pour :\n‚úÖ \nR√©cup√©rer le code source depuis GitHub.\n‚úÖ Exporter et stocker l‚Äôapplication Joget sous forme de fichier .jwa  dans Nexus.\n‚úÖ Configurer et ex√©cuter SonarQube Scanner pour analyser les fichiers Java, \nSQL et JavaScript.\n‚úÖ Ex√©cuter des scripts  pour extraire du code de Joget.\n‚úÖ Envoyer une notification par e-mail en cas de succ√®s ou d‚Äô√©chec du pipeline.\nüìå Structure G√©n√©rale\npipeline {\n    agent any\n    environment {\n        SONAR_HOST_URL = 'http://192.168.193.128:9000'\n        SONAR_TOKEN = 'squ_b6986d26e43b9a5c9fe5c8247fb84abdb22995a\n4'\n    }\nExplication :\nagent any  : Le pipeline s'ex√©cute sur n'importe quel agent disponible dans \nJenkins.\nenvironment  : D√©finit les variables d‚Äôenvironnement pour SonarQube :\nSONAR_HOST_URL  : URL du serveur SonarQube.\nSONAR_TOKEN  : Token d‚Äôauthentification pour SonarQube.\n1Ô∏è‚É£\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n25\n\n1Ô∏è‚É£ Stage : Checkout Code\nstage('Checkout Code') {\n    steps {\n        script {\n            echo \"üì• Cloning repository: main\"\n        }\n        git branch: 'main', url: 'https://github.com/motrabelsi10/testpipeline.git'\n    }\n}\nExplication :\nR√©cup√®re le code source depuis GitHub.\nAffiche un message de confirmation.\n2Ô∏è‚É£ Stage : Export & Upload JWA to Nexus\nstage('Export & Upload JWA to Nexus (joget-repo)') {\n    steps {\n        script {\n            echo \"üì¶ Exporting application RSU from Joget...\"\n        }\n        sh '''\n        APP_NAME=\"vente_voitures\"\n        APP_ID=\"1\"\n        TIMESTAMP=$(date +\"%Y%m%d%H%M%S\")\n        JWA_FILE=\"APP_${APP_NAME}-${APP_ID}-${TIMESTAMP}.jwa\"\n        EXPORT_PATH=\"/opt/joget/wflow/export\"\n        echo \"üì¶ Exporting: Name=$APP_NAME, ID=$APP_ID, File=$JWA_FILE\"\n        docker exec -u root jogetapp  -c \"apt-get update && apt-get install -y zi\np\"\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n26\n\n        docker exec -u root jogetapp  -c \"mkdir -p ${EXPORT_PATH} && chmod -\nR 777 ${EXPORT_PATH}\"\n        docker exec jogetapp  -c \"cd /opt/joget/wflow/app_src && zip -r ${EXPO\nRT_PATH}/${JWA_FILE} ${APP_NAME} -x \\\"${APP_NAME}/.git/*\\\"\"\n        FILE_SIZE=$(docker exec jogetapp  -c \"stat -c %s ${EXPORT_PATH}/${J\nWA_FILE}\")\n        if [ \"$FILE_SIZE\" -lt 1024 ]; then\n            echo \"‚ùå ERROR: Exported JWA file seems empty (size: ${FILE_SIZE} \nbytes).\"\n            exit 1\n        fi\n        echo \"‚úÖ Export successful! File: ${JWA_FILE} (Size: ${FILE_SIZE} byte\ns)\"\n        docker cp jogetapp:${EXPORT_PATH}/${JWA_FILE} .\n        if [ ! -f \"${JWA_FILE}\" ]; then\n            echo \"‚ùå ERROR: JWA file was not copied correctly to Jenkins.\"\n            exit 1\n        fi\n        echo \"üì§ Uploading ${JWA_FILE} to Nexus...\"\n        curl -u admin:Mouhamed2000** --upload-file ${JWA_FILE} \\\n        \"http://192.168.193.128:8082/repository/vente_voitures-repo/com/voiture\ns/jwa/${APP_ID}/${JWA_FILE}\"\n        echo \"‚úÖ Upload completed successfully to joget-repo!\"\n        '''\n    }\n}\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n27\n\nExplication :\nExporte l'application Joget sous format .jwa .\nV√©rifie la validit√© du fichier (taille > 1 Ko).\nCopie le fichier de Joget vers Jenkins.\nUpload vers Nexus.\n3Ô∏è‚É£ Stage : Installation du Scanner SonarQube\nstage('Prepare SonarQube Scanner') {\n    steps {\n        script {\n            echo \"üîç Checking if SonarQube Scanner is installed...\"\n        }\n        sh '''\n            if [ ! -d \"sonar-scanner\" ]; then\n                echo \"üöÄ Installing SonarQube Scanner...\"\n                apt-get update && apt-get install -y wget unzip\n                wget -q https://binaries.sonarsource.com/Distribution/sonar-scanne\nr-cli/sonar-scanner-cli-5.0.1.3006-linux.zip -O sonar-scanner.zip\n                unzip -q sonar-scanner.zip\n                mv sonar-scanner-5.0.1.3006-linux sonar-scanner\n                chmod +x sonar-scanner/bin/sonar-scanner\n            else\n                echo \"‚úÖ SonarQube Scanner is already installed.\"\n            fi\n        '''\n    }\n}\nExplication :\nV√©rifie si SonarQube Scanner est d√©j√† install√©, sinon il l‚Äôinstalle.\n4Ô∏è‚É£\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n28\n\n4Ô∏è‚É£ Stage : Pr√©paration de Joget\nstage('Prepare Joget Environment') {\n    steps {\n        sh 'docker exec -i jogetapp  -c \"mkdir -p /opt/joget/wflow/scripts/output \n&& chmod -R 777 /opt/joget/wflow/scripts/output\"'\n    }\n}\nExplication :\nCr√©e le r√©pertoire output  pour stocker les fichiers extraits.\nAssigne les permissions n√©cessaires.\n5Ô∏è‚É£ Stage : Ex√©cution des Scripts \nstage('Run  Script') {\n    steps {\n        sh '''\n            docker exec -i jogetapp  -c \"3 /opt/joget/wflow/scripts/extract_code.p\ny\"\n            docker exec -i jogetapp  -c \"3 /opt/joget/wflow/scripts/extract_js.py\"\n        '''\n    }\n}\nExplication :\nEx√©cute les scripts  pour extraire le code Java, SQL et JavaScript de Joget.\n6Ô∏è‚É£ Stage : Copie des Fichiers Extraits\nstage('Copy Extracted Files to Jenkins') {\n    steps {\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n29\n\n        sh '''\n            rm -rf output\n            mkdir -p output/java output/sql output/js\n            docker cp jogetapp:/opt/joget/wflow/scripts/output/java ./output/\n            docker cp jogetapp:/opt/joget/wflow/scripts/output/sql ./output/\n            docker cp jogetapp:/opt/joget/wflow/scripts/output/js ./output/\n        '''\n    }\n}\nExplication :\nSupprime les anciens fichiers.\nCopie les nouveaux fichiers extraits vers Jenkins.\n7Ô∏è‚É£ Stage : V√©rification des Fichiers\nstage('Verify Extracted Files in Jenkins') {\n    steps {\n        sh 'ls -R ./output || echo \"üö® No extracted files found!\"'\n    }\n}\nExplication :\nAffiche les fichiers extraits ou une alerte si aucun fichier n‚Äôa √©t√© trouv√©.\n8Ô∏è‚É£ Stage : Analyse SonarQube\nstage('SonarQube Analysis') {\n    steps {\n        sh '''\n            if [ -d \"./output/java\" ] || [ -d \"./output/sql\" ] || [ -d \"./output/js\" ]; then\n                echo \"‚úÖ Files found, proceeding with SonarQube analysis...\"\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n30\n\n                sonar-scanner/bin/sonar-scanner \\\n                  -Dsonar.projectKey=voitures \\\n                  -Dsonar.projectName=voitures \\\n                  -Dsonar.host.url=\"${SONAR_HOST_URL}\" \\\n                  -Dsonar.login=\"${SONAR_TOKEN}\" \\\n                  -Dsonar.sources=./output \\\n                  -Dsonar.inclusions=\"**/*.java,**/*.sql,**/*.js\" \\\n                  -Dsonar.sourceEncoding=UTF-8 \\\n                  -Dsonar.verbose=true\n            else\n                echo \"üö® ERROR: No Java, SQL, or JS files found in ./output!\"\n                exit 1\n            fi\n        '''\n    }\n}\nExplication :\nV√©rifie la pr√©sence de fichiers.\nEx√©cute l‚Äôanalyse SonarQube.\nüì® Notifications par E-mail\npost {\n    success {\n        script {\n            mail to: 'mouhamedtrabelsi.28@gmail.com',\n                 subject: \"Succ√®s du build: ${env.JOB_NAME} #${env.BUILD_NUMB\nER}\",\n                 body: \"Le build a r√©ussi ! Consultez le lien suivant : ${env.BUILD_UR\nL}\"\n        }\n    }\n    failure {\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n31\n\n        script {\n            mail to: 'mouhamedtrabelsi.28@gmail.com',\n                 subject: \"√âchec du build: ${env.JOB_NAME} #${env.BUILD_NUMBE\nR}\",\n                 body: \"Le build a √©chou√© ! Consultez le lien suivant : ${env.BUILD_U\nRL}\"\n        }\n    }\n}\nExplication :\nEnvoie une notification par e-mail en cas de succ√®s ou d‚Äô√©chec.\nüöÄ Ce pipeline assure une automatisation compl√®te du cycle CI/CD avec Joget, \nNexus et SonarQube !\nInt√©gration de GitHub avec Joget, SonarQube, Nexus et Automatisation via Docker\n32\n\n"
}