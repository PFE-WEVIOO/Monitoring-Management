{
  "filename": "ELK monitoring.pdf",
  "content": "ELK / EFK \nðŸš€ Pipeline ELK â€“ Ã‰tapes de mise en place\nðŸŸ¢ Ã‰tape 1 : PrÃ©paration de lâ€™environnement ELK\n1. Installer Elasticsearch\nMoteur de recherche + stockage des logs\nConfigurer la mÃ©moire, les limites, les ports (9200/9300)\n2. Installer Kibana\nInterface de visualisation\nConnectÃ©e Ã  Elasticsearch (port 5601)\n3. Installer Logstash\nCollecte + traitement des logs\nPorts Ã  exposer : 5044 (Filebeat) ou lecture locale de fichiers\nðŸ“¦ Ã‰tape 2 : Log Shipping (ðŸš¨ câ€™est ce que tu viens de faire)\n1. RÃ©cupÃ©rer les logs depuis les applications distantes\nðŸ³ Docker logs depuis pipeline-ci  : Joget, MySQL, SonarQube\nðŸ“ Transfert rÃ©gulier des fichiers .log , .gz  vers la machine monitoring\n2. Centraliser tous les fichiers dans un rÃ©pertoire commun\nExemple : /home/vagrant/monitoring-data/fichiers-logs/\nâš™ï¸ Ã‰tape 3 : Ingestion et parsing des logs avec Logstash\n1. CrÃ©er une configuration logstash.conf\ninput  : lire les fichiers de logs\nELK / EFK\n1\n\nfilter  : grok / dissect / date / mutate (selon la structure)\noutput  : envoyer dans Elasticsearch (index personnalisÃ© par app)\n2. Test local de la configuration\n```bash\ndocker logs logstash  pour vÃ©rifier quâ€™il nâ€™y a pas dâ€™erreurs\n```\nUtiliser un fichier Ã  la fois si besoin\nðŸ“Š Ã‰tape 4 : Indexation et stockage dans Elasticsearch\n1. CrÃ©er ou personnaliser des index\nNommer par application ( joget-* , sonarqube-* , etc.)\nGÃ©rer les mappings si besoin\n2. VÃ©rifier lâ€™ingestion avec la requÃªte :\n```bash\ncurl -X GET http://localhost:9200/_cat/indices?v\n```\nðŸ‘€ Ã‰tape 5 : Visualisation dans Kibana\n1. CrÃ©er un index pattern dans Kibana\nExemple : joget-*\nSÃ©lectionner le champ @timestamp  pour le tri\n2. CrÃ©er des dashboards personnalisÃ©s\nNombre dâ€™erreurs, warning, heatmap, top logs par source, etc.\nâœ… 1. Trouver les fichiers de logs dans chaque conteneur\nOn va dâ€™abord Â« entrer Â» dans chaque conteneur pour chercher les fichiers de \nlogs Ã  l'intÃ©rieur.\nðŸ” A. SonarQube\nbash\nCopierModifier\nELK / EFK\n2\n\n```bash\ndocker exec -it sonarqube bash\n```\nPuis, Ã  lâ€™intÃ©rieur du conteneur :\nbash\nCopierModifier\nls /opt/sonarqube/logs\nTu y verras des fichiers comme web.log , ce.log , es.log , etc.\nTu peux ensuite faire par exemple :\nbash\nCopierModifier\ncat /opt/sonarqube/logs/web.log | tail -n 20\nPour voir les 20 derniÃ¨res lignes.\nðŸ” B. Joget\nbash\nCopierModifier\n```bash\ndocker exec -it joget bash\n```\nPuis cherche ici :\nbash\nCopierModifier\nls /opt/joget/apache-tomcat/logs\nLes fichiers seront des logs Tomcat comme catalina.out , localhost.log , etc.\nELK / EFK\n3\n\nðŸ” C. MySQL\nbash\nCopierModifier\n```bash\ndocker exec -it jogetdb bash\n```\nPuis tente :\nbash\nCopierModifier\nls /var/log/mysql\nOU parfois câ€™est plutÃ´t dans :\nbash\nCopierModifier\nls /var/lib/mysql\nTu peux faire :\nbash\nCopierModifier\ncat /var/log/mysql/error.log | tail -n 20\nTransfÃ©rer les logs de VM pipeline-ci  âžœ VM monitoring  \nchaque 5 min\nOn va crÃ©er un script bash ou script Python + une tÃ¢che cron sur la machine \npipeline-ci  qui :\nSe connecte Ã  monitoring  ( 192.168.56.150 )\nELK / EFK\n4\n\nTransfÃ¨re tous les logs des conteneurs vers :\n/home/vagrant/monitoring-data/fichiers-logs/\nðŸ”§ Option 1 : Script Bash (simple, efficace)\nðŸ“ CrÃ©e un script /home/vagrant/send-logs.sh  sur pipeline-ci  :\nbash\nCopierModifier\n#!/bin/bash\n# Dossier de logs dans chaque conteneur\nLOG_DIRS=(\n  \"/opt/joget/apache-tomcat/logs\"\n  \"/var/log\"\n  \"/opt/sonarqube/logs\"\n)\n# Nom des conteneurs\nCONTAINERS=(\"joget\" \"jogetdb\" \"sonarqube\")\n# Dossier temporaire\nTMP_DIR=\"/tmp/logs_to_send\"\nmkdir -p \"$TMP_DIR\"\n# RÃ©cupÃ©ration des logs de chaque conteneur\nfor i in \"${!CONTAINERS[@]}\"; do\n  container=\"${CONTAINERS[$i]}\"\n  log_path=\"${LOG_DIRS[$i]}\"\n  docker cp \"$container:$log_path\" \"$TMP_DIR/$container\"\ndone\n# Envoi vers monitoring\n```bash\nscp -i /home/vagrant/.ssh/monitoring_key -o StrictHostKeyChecking=no -r \n```\n\"$TMP_DIR\"/* vagrant@192.168.56.150:/home/vagrant/monitoring-data/fichier\ns-logs/\nELK / EFK\n5\n\n# Nettoyage temporaire\nrm -rf \"$TMP_DIR\"\nDonne les permissions dâ€™exÃ©cution :\nbash\nCopierModifier\nchmod +x /home/vagrant/send-logs.sh\nâ±ï¸ Configurer le cron (chaque 5 minutes)\nLance :\nbash\nCopierModifier\ncrontab -e\nAjoute la ligne suivante :\nbash\nCopierModifier\n*/5 * * * * /home/vagrant/send-logs.sh >> /home/vagrant/send-logs.log 2>&1\nðŸ§ª Tu peux tester Ã  la main d'abord :\nbash\nCopierModifier\n/home/vagrant/send-logs.sh\nELK / EFK\n6\n\nEnsuite vÃ©rifie sur la VM monitoring  :\nbash\nCopierModifier\nls /home/vagrant/monitoring-data/fichiers-logs\nELK / EFK\n7\n\n"
}